# ETBX mail service
 

## API
 

### `POST http://etbx.ru:7070/register`
 
Запрос для регистрации пользователя в почте `@pmc-python.ru`
 
**Параметры:**
 

    {
        "name":"Имя",
        "surname":"Фамилия",
        "birthday":"Дата рождения (формат 31-01-2000)",
        "gender":"Пол (Male или Female)",
        "mail":"Выбранная почта (Пример: test [без @domen.ru])",
        "phone_num": "Номер телефона (не обязательно)",
        "password": "Пароль"
    }

**Возвращает:**
 

    {
        "token" : "токен пользователя"
    }


**Исключения:**
 

    Код 400: Пользователь с таким логином уже зарегистрирован

    Код 502: Ошибка регистрации на внешнем сервере
    

### `POST http://etbx.ru:7070/login`
 
**Параметры:**

 
    {
        "email": "Логин с указателем почты. Например: test@pmc-python.ru",
        "password": "Пароль"
    }

**Возвращает:**
 

    {
        "token" : "токен пользователя"
    }


**Исключения:**
 

    Код 401: Неправильный логин или пароль


### `POST http://etbx.ru:7070/logout`
 
Функция выхода из аккаунта (выполняется с использованием **Bearer Token)**
 
**Возвращает:**
 

    Сообщение об успешном выходе из аккаунта (токен деактивируется)


### `PUT http://etbx.ru:7070/edit_avatar`
 
Функция добавления аватара пользователя (выполняется с использованием Bearer Token). Если размеры некорректны, то измняет их до 512x512 px
 
**Параметры (form-data):**
 

    {
        "avatar": File.png
    }

**Возвращает:**
 

    {
        "message": "Аватар успешно обновлен"
    }


**Исключения:**
 

    Код 400: Неверный формат файла

    Код 413: Размер файла слишком большой (не более 10 Мб)
    
    Код 500: Ошибка при обработке файла


### `GET http://etbx.ru:7070/users/me`
 
Функция просмотра данных своего профиля (выполняется с использованием **Bearer Token)**
 
**Возвращает:**
 

    {
        "id": id_пользователя,
        "Имя": "Имя",
        "Фамилия": "Фамилия",
        "Дата рождения": "В формате ДД-ММ-ГГГГ",
        "Пол": "Male или Female",
        "Логин": "Логин",
        "Номер_телефона": "Номер телефона или 'Отсутствует', если его нет",
        "Аватар": Путь к изображению или null,
        "token": "Токен пользователя"
    }

### `PUT http://etbx.ru:7070/edit`
 
Функция изменения данных в профиле (выполняется с использованием **Bearer Token)**
 
**Параметры:**
 

    {
        "name":"Имя (не обязательно)",
        "surname":"Фамилия (не обязательно)",
        "birthday":"Дата рождения (не обязательно)",
        "gender":"Пол (не обязательно)",
        "phone_num": "Номер телефона (не обязательно)",
        "password":"Пароль (не обязательно)"
    }

**Возвращает:**
 

    Сообщение об успешном изменении данных


**Исключения:**
 

    Код 500: Ошибка при обновлении профиля
    
    Код 502: Ошибка изменения данных на внешнем сервере


### `GET http://etbx.ru:7070/avatars/{id}/`
 
Функция просмотра аватара пользователя с id id (выполняется с использованием **Bearer Token)**
 
**Параметры:**
 

    [ID пользователя]

**Возвращает:**
 

    [Изображение аватара]


**Исключения:**
 

    Код 404: Not Found


### `GET http://etbx.ru:7070/users/{id}/`
 
Функция просмотра данных пользователя (выполняется с использованием **Bearer Token)**
 
**Параметры:**
 

    [ID пользователя]

**Возвращает:**
 

    {
        "id": ID пользователя,
        "Имя": "Имя",
        "Фамилия": "Фамилия",
        "Дата рождения": "дата в формате ДД-ММ-ГГГГ",
        "Пол": "Male или Female",
        "Логин": "Логин",
        "Номер_телефона ": "Номер телефона или null, если его нет",
        "Аватар":  Путь к изображению или null,
    }


**Исключения:**
 

    Код 404: Пользователь с id не найден

    
### `GET http://etbx.ru:7070/users?page=1&page_size=1`
 
Функция просмотра данных пользователей (выполняется с использованием **Bearer Token)**
 
**Возвращает:**
 

    {
        "total_users": 1,
        "users": [
            {
                "id": ID пользователя,
                "Имя": "Имя",
                "Фамилия": "Фамилия",
                "Дата рождения": "Дата в формате ДД-ММ-ГГГГ",
                "Пол": "Male или Female",
                "Почта": "Почта",
                "Номер телефона": "Номер телефона или null, если его нет",
                "Аватар":  Путь к изображению или null,
            },
            ...
        ]
    }


### `GET http://etbx.ru:7070/messages/{folder}`
 
Функция получения сообщений из папки (выполняется с использованием **Bearer Token)**

Доступные папки: 

    inbox - Входящие сообщения
    Sent - Отправленные сообщения
    Drafts - Черновики
    Trash - Корзина
    noread - непрочитанные

**Возвращает:**


    {
        "messages": [
            {
                "id": id сообщения 1,
                "Тема": "Тема сообщения 1",
                "Сообщение": "Текст сообщения 1",
                "Отправитель": "отправитель 1@etbx.ru",
                "Получатель": "получатель 1@etbx.ru",
                "Время получения": "24:59 31.12.2024 ",
                "Файлы": [
                   "{папка}_${id_сообщения}_${название_файла}"
                ]
            },
            {
                "id": id сообщения 2,
                "Тема": "Тема сообщения 2",
                "Сообщение": "Текст сообщения 2",
                "Отправитель": "отправитель 2@etbx.ru",
                "Получатель": "получатель 2@etbx.ru",
                "Время получения": "22:40 31.12.2024 ",
                "Файлы": []
            },
            ...
        ]
    }


**ВАЖНО:**


    В файлах указаны пути к файлам. _$ - является разделителем


### `POST http://etbx.ru:7070/send`
 
Функция отправки сообщения пользователю (выполняется с использованием **Bearer Token)**
 
**Параметры:**
 

    {
        "theme": "Тема сообщения (не обязательно)",
        "body": "Текст сообщения",
        "reciever": "Адрес получателя (пример: test@etbx.ru)"
    }

**Возвращает:**
 

    Сообщение об успешной отправки сообщения


### `GET http://etbx.ru:7070/get_my_chats`
 
Функция получения всех пользователей, с которыми велась переписка (выполняется с использованием **Bearer Token)**


**Возвращает:**


    {
        "chats": [
            "user1@domen.ru",
            "user2@domen.ru",
            ...
        ]
    }


### `GET http://etbx.ru:7070/get_themes_of_chat/{interlocutor}`
 
Функция получения всех тем из переписки с пользователем {interlocutor} (выполняется с использованием **Bearer Token)**


**Возвращает:**


    {
        "themes": [
            "Theme 1",
            "Theme 2",
            ...
        ]
    }


### `GET http://etbx.ru:7070/get_messages_by_theme/{interlocutor}/{theme}`
 
Функция получения всех сообщений из переписки с пользователем {interlocutor} из темы {theme} (выполняется с использованием **Bearer Token)**


**Возвращает (время отсортировано по возрастанию):**


    {
        "messages": [
            {
                "id": "1",
                "subject": "Тема 1",
                "body": "Текст 1",
                "sender": "Собеседник 1",
                "recipient": "Собеседник 2",
                "received_time": "21:14 24.06.2024",
                "Файлы": [
                   "{папка}_${id_сообщения}_${название_файла}"
                ]
            },
            {
                "id": "1",
                "subject": "Тема 1",
                "body": "Текст 2",
                "sender": "Собеседник 2",
                "recipient": "Собеседник 1",
                "received_time": "21:15 24.06.2024",
                "Файлы": []
            },
            {
                "id": "4",
                "subject": "Тема 1",
                "body": "Текст 3",
                "sender": "Собеседник 1",
                "recipient": "Собеседник 2",
                "received_time": "21:16 24.06.2024",
                "Файлы": []
            },
            ...
        ]
    }

**ВАЖНО:**


    id сообщения могут повторяться, так как они хранятся на внешнем сервере и в разных папках


### `GET http://etbx.ru:7070/attachments/{folder}/{mail_id}/{file_name}`
 
Функция загрузки файла из папки {folder}, сообщения с id {mail_id} и названием файла {file_name} (выполняется с использованием **Bearer Token)**


**Возвращает:**


    ФАЙЛ для загрузки


**Исключения:**
 

    Код 404: Файл не найден

    
